---
// Side-by-side page transition with shrink/slide/expand effect
---

<style is:global>
    /* Add padding for fixed header */
    body {
        padding-top: 80px;
        background-color: #222;
    }

    /* Page content wrapper default state */
    .page-content-wrapper {
        position: relative;
        background-color: #eee;
        min-height: calc(100vh);
        margin-top: -120px;
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                    border-radius 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                    box-shadow 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Phase 1: Shrink - current page shrinks and gets rounded */
    body.is-shrinking .page-content-wrapper {
        transform: scale(0.65);
        border-radius: 24px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        overflow: hidden;
    }

    /* Phase 2: Slide out - page slides to the left */
    body.is-sliding-out .page-content-wrapper {
        transform: scale(0.65) translateX(-120%);
        border-radius: 24px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        overflow: hidden;
    }

    /* Phase 3: Enter shrunk - new page starts shrunk and slides in from right */
    body.is-entering .page-content-wrapper {
        transform: scale(0.65) translateX(0);
        border-radius: 24px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        overflow: hidden;
        animation: slideInShrunk 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    /* Phase 4: Expand - new page expands to full */
    body.is-expanding .page-content-wrapper {
        animation: expandToFull 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @keyframes slideInShrunk {
        0% {
            transform: scale(0.65) translateX(120%);
        }
        100% {
            transform: scale(0.65) translateX(0);
        }
    }

    @keyframes expandToFull {
        0% {
            transform: scale(0.65);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        100% {
            transform: scale(1);
            border-radius: 0;
            box-shadow: none;
        }
    }
</style>

<script>
    function isInternalLink(href: string | null): boolean {
        if (!href) return false;
        return !href.startsWith('http') &&
               !href.startsWith('#') &&
               !href.startsWith('mailto:') &&
               !href.startsWith('tel:');
    }

    // Handle all internal link clicks
    document.addEventListener('click', (e) => {
        const link = (e.target as HTMLElement).closest('a');
        if (!link) return;

        const href = link.getAttribute('href');

        // Skip external links, anchors, and special links
        if (!isInternalLink(href) ||
            link.hasAttribute('download') ||
            link.getAttribute('target') === '_blank') {
            return;
        }

        e.preventDefault();

        // Set flag for the new page
        sessionStorage.setItem('pageTransition', 'true');

        // Phase 1: Shrink
        document.body.classList.add('is-shrinking');

        // Phase 2: Slide out after shrink
        setTimeout(() => {
            document.body.classList.remove('is-shrinking');
            document.body.classList.add('is-sliding-out');
        }, 400);

        // Navigate after slide out
        setTimeout(() => {
            window.location.href = href!;
        }, 700);
    });

    // On page load, check if we came from a transition
    if (sessionStorage.getItem('pageTransition') === 'true') {
        sessionStorage.removeItem('pageTransition');

        // Phase 3: Enter shrunk and slide in
        document.body.classList.add('is-entering');

        // Phase 4: Expand after slide in
        setTimeout(() => {
            document.body.classList.remove('is-entering');
            document.body.classList.add('is-expanding');
        }, 500);

        // Clean up
        setTimeout(() => {
            document.body.classList.remove('is-expanding');
        }, 900);
    }
</script>
