---
// Side-by-side page transition with shrink/slide/expand effect
---

<style is:global>
    /* Add padding for fixed header */
    body {
        padding-top: 80px;
        background-color: #222;
    }

    /* Page content wrapper default state */
    .page-content-wrapper {
        position: relative;
        background-color: #eee;
        min-height: calc(100vh);
        margin-top: -120px;
        transform-origin: center center;
        will-change: transform, border-radius;
    }

    /* Exit animation - shrink then slide left */
    body.is-exiting .page-content-wrapper {
        animation: exitAnimation 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    /* Enter animation - slide in from right then expand */
    body.is-entering .page-content-wrapper {
        animation: enterAnimation 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @keyframes exitAnimation {
        0% {
            transform: scale(1) translateX(0);
            border-radius: 0;
            box-shadow: none;
        }
        35% {
            transform: scale(0.75) translateX(0);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }
        100% {
            transform: scale(0.75) translateX(-150%);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }
    }

    @keyframes enterAnimation {
        0% {
            transform: scale(0.75) translateX(150%);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }
        50% {
            transform: scale(0.75) translateX(0);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }
        100% {
            transform: scale(1) translateX(0);
            border-radius: 0;
            box-shadow: none;
        }
    }

    /* WordPress Gutenberg alignment classes */
    .entry-content {
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        padding-left: 1.5rem;
        padding-right: 1.5rem;
    }

    .entry-content .alignwide {
        max-width: 100%;
        margin-left: -2rem;
        margin-right: -2rem;
    }

    .entry-content .alignfull,
    .entry-content .wp-block-cover.alignfull,
    .entry-content .wp-block-image.alignfull,
    .entry-content .wp-block-group.alignfull {
        max-width: none !important;
        width: 100vw !important;
        margin-left: calc(50% - 50vw) !important;
        margin-right: calc(50% - 50vw) !important;
        padding-left: 0;
        padding-right: 0;
    }

    .entry-content .alignleft {
        float: left;
        margin-right: 2rem;
        max-width: 50%;
    }

    .entry-content .alignright {
        float: right;
        margin-left: 2rem;
        max-width: 50%;
    }

    .entry-content .aligncenter {
        margin-left: auto;
        margin-right: auto;
        text-align: center;
    }

    /* Clear floats */
    .entry-content::after {
        content: "";
        display: table;
        clear: both;
    }

    /* Ensure alignfull images and covers work properly */
    .entry-content .alignfull img,
    .entry-content .alignfull video {
        width: 100%;
    }

    /* WordPress columns block */
    .wp-block-columns {
        gap: 2em;
    }

    /* WordPress Cover Block */
    .wp-block-cover {
        position: relative;
        background-size: cover;
        background-position: center center;
        min-height: 430px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

    .wp-block-cover__background {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        z-index: 1;
    }

    /* Default opacity when has-background-dim is present without specific level */
    .wp-block-cover__background.has-background-dim:not([class*="-background-dim-"]) {
        opacity: 0.5;
    }

    /* Cover block overlay opacity levels - applied directly on the span */
    .wp-block-cover__background.has-background-dim-0 {
        opacity: 0;
    }

    .wp-block-cover__background.has-background-dim-10 {
        opacity: 0.1;
    }

    .wp-block-cover__background.has-background-dim-20 {
        opacity: 0.2;
    }

    .wp-block-cover__background.has-background-dim-30 {
        opacity: 0.3;
    }

    .wp-block-cover__background.has-background-dim-40 {
        opacity: 0.4;
    }

    .wp-block-cover__background.has-background-dim-50 {
        opacity: 0.5;
    }

    .wp-block-cover__background.has-background-dim-60 {
        opacity: 0.6;
    }

    .wp-block-cover__background.has-background-dim-70 {
        opacity: 0.7;
    }

    .wp-block-cover__background.has-background-dim-80 {
        opacity: 0.8;
    }

    .wp-block-cover__background.has-background-dim-90 {
        opacity: 0.9;
    }

    .wp-block-cover__background.has-background-dim-100 {
        opacity: 1;
    }

    .wp-block-cover__image-background,
    .wp-block-cover__video-background {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        max-width: none;
        max-height: none;
        object-fit: cover;
        outline: none;
        border: none;
        box-shadow: none;
        z-index: 0;
    }

    .wp-block-cover__inner-container {
        position: relative;
        z-index: 2;
        width: 100%;
        color: #fff;
        padding: 1em;
    }

    /* Cover block with gradient overlay */
    .wp-block-cover .wp-block-cover__gradient-background {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        z-index: 1;
    }


    /* Fixed and repeated background options */
    .wp-block-cover.has-parallax {
        background-attachment: fixed;
    }

    .wp-block-cover.is-repeated {
        background-repeat: repeat;
        background-size: auto;
    }

    /* Fix for alignfull inside page-content-wrapper during transitions */
    .page-content-wrapper {
        overflow-x: clip;
    }

    body.is-exiting .page-content-wrapper,
    body.is-entering .page-content-wrapper {
        overflow: hidden;
    }
</style>

<script>
    function isInternalLink(href: string | null): boolean {
        if (!href) return false;
        return !href.startsWith('http') &&
               !href.startsWith('#') &&
               !href.startsWith('mailto:') &&
               !href.startsWith('tel:');
    }

    // Handle all internal link clicks
    document.addEventListener('click', (e) => {
        const link = (e.target as HTMLElement).closest('a');
        if (!link) return;

        const href = link.getAttribute('href');

        // Skip external links, anchors, and special links
        if (!isInternalLink(href) ||
            link.hasAttribute('download') ||
            link.getAttribute('target') === '_blank') {
            return;
        }

        // Skip if navigating to the current page
        const currentPath = window.location.pathname;
        const targetPath = new URL(href, window.location.origin).pathname;
        if (currentPath === targetPath ||
            currentPath === targetPath + '/' ||
            currentPath + '/' === targetPath) {
            e.preventDefault();
            return;
        }

        e.preventDefault();

        // Set flag for the new page
        sessionStorage.setItem('pageTransition', 'true');

        // Start exit animation (shrink then slide left)
        document.body.classList.add('is-exiting');

        // Navigate after exit animation completes
        setTimeout(() => {
            window.location.href = href!;
        }, 800);
    });

    // On page load, check if we came from a transition
    if (sessionStorage.getItem('pageTransition') === 'true') {
        sessionStorage.removeItem('pageTransition');

        // Start enter animation (slide in from right then expand)
        document.body.classList.add('is-entering');

        // Clean up after animation completes
        setTimeout(() => {
            document.body.classList.remove('is-entering');
        }, 1000);
    }
</script>
